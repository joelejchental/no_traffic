name: CI Pipeline  # Name of the GitHub Actions pipeline.

on:
  push:
    branches:
      - main  # Run tests on push to the main branch
      - develop  # Run tests on push to the develop branch
  pull_request:
    branches:
      - main  # Run tests on PRs targeting the main branch
      - develop  # Run tests on PRs targeting the develop branch

jobs:
  test:
    runs-on: ubuntu-latest  # The job runs on the latest Ubuntu runner provided by GitHub Actions.

    steps:
    - name: Checkout repository  # Step 1: Check out the code from the GitHub repository.
      uses: actions/checkout@v2  # Uses the `actions/checkout` action to fetch the repo.

    - name: Set up Python  # Step 2: Set up Python environment
      uses: actions/setup-python@v2  # Sets up Python on the runner.
      with:
        python-version: 3.9  # You can change this to the version of Python you want to use.

    - name: Install dependencies  # Step 3: Install dependencies
      run: |
        python -m venv venv  # Create a virtual environment.
        source venv/bin/activate  # Activate the virtual environment.
        pip install -r requirements.txt  # Install dependencies from requirements.txt.

    - name: Run tests  # Step 4: Run tests using pytest
      run: |
        source venv/bin/activate  # Activate the virtual environment.
        pytest --maxfail=1 --disable-warnings -q  # Run pytest with the specified flags:
        # --maxfail=1: Stop after the first failure.
        # --disable-warnings: Disable warnings during the test run.
        # -q: Run tests in quiet mode, less verbose output.

    - name: Upload test results as artifacts  # Step 5: Upload test results as artifacts.
      uses: actions/upload-artifact@v3  # Use the upload-artifact action to store results.
      with:
        name: test-results  # Name for the artifact.
        path: path/to/test-results/*.xml  # Path to test result files (adjust as needed).
